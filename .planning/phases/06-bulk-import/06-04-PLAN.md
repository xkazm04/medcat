---
phase: 06-bulk-import
plan: 04
type: execute
wave: 4
depends_on: ["06-03"]
files_modified:
  - src/components/import/import-wizard.tsx
  - src/components/import/import-summary.tsx
  - src/app/import/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate through import wizard steps"
    - "Import executes and shows progress during batch operations"
    - "Summary shows final counts of created, updated, skipped, errors"
    - "Import page is accessible from navigation"
  artifacts:
    - path: "src/components/import/import-wizard.tsx"
      provides: "Multi-step wizard container managing import flow state"
      exports: ["ImportWizard"]
    - path: "src/components/import/import-summary.tsx"
      provides: "Import results display with counts and error details"
      exports: ["ImportSummary"]
    - path: "src/app/import/page.tsx"
      provides: "Import page route with vendor selection"
      exports: ["default"]
  key_links:
    - from: "src/components/import/import-wizard.tsx"
      to: "src/lib/actions/import.ts"
      via: "importProducts call"
      pattern: "importProducts"
    - from: "src/app/import/page.tsx"
      to: "src/components/import/import-wizard.tsx"
      via: "ImportWizard import"
      pattern: "import.*ImportWizard"
    - from: "src/app/import/page.tsx"
      to: "src/lib/queries.ts"
      via: "getVendors for vendor selection"
      pattern: "import.*getVendors"
---

<objective>
Create the import wizard container, summary component, and import page.

Purpose: Integrate all import steps into a cohesive wizard flow with progress feedback and final summary.
Output: Working import feature accessible at /import route with full wizard flow.
</objective>

<execution_context>
@C:\Users\kazda\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kazda\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-bulk-import/06-RESEARCH.md
@.planning/phases/06-bulk-import/06-03-SUMMARY.md
@src/lib/actions/import.ts
@src/lib/queries.ts
@src/components/import/file-upload-step.tsx
@src/components/import/column-mapping-step.tsx
@src/components/import/validation-step.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create import wizard container and summary</name>
  <files>src/components/import/import-wizard.tsx, src/components/import/import-summary.tsx</files>
  <action>
1. Create `src/components/import/import-summary.tsx`:
   - Props: `{ result: ImportResult; onReset: () => void }`
   - Display:
     a. Success icon (CheckCircle) if no errors, warning icon if some errors
     b. Large text: "Import Complete"
     c. Stats grid showing created, updated, skipped counts with icons
     d. If errors exist, expandable section showing error details (row, field, message)
   - Buttons:
     a. "Import More" - calls onReset to restart wizard
     b. "View Catalog" - Link to "/"
   - Use Tailwind styling consistent with project

2. Create `src/components/import/import-wizard.tsx`:
   - 'use client' directive
   - Props: `{ vendors: Vendor[] }` - list of vendors for selection

   - State management:
     ```typescript
     type ImportStep = 'vendor' | 'upload' | 'mapping' | 'validation' | 'importing' | 'summary';

     interface WizardState {
       step: ImportStep;
       vendorId: string;
       file: File | null;
       headers: string[];
       previewData: CSVRow[];
       fullData: CSVRow[];
       mapping: Record<string, string>;
       validRows: ImportRow[];
       existingCount: number;
       result: ImportResult | null;
     }
     ```

   - Step flow:
     a. **vendor**: Dropdown to select vendor (required before import since SKU deduplication is per-vendor). Show vendor select with "Next" button.
     b. **upload**: FileUploadStep component. On file select, parse full CSV with parseCSVFull(), store data, advance to mapping.
     c. **mapping**: ColumnMappingStep component. "Next" button validates required fields mapped, advances to validation.
     d. **validation**: ValidationStep component. Shows validation results, "Import X Products" button (disabled if no valid rows).
     e. **importing**: Progress display showing "Importing... X/Y rows". Call importProducts() with chunking, update progress.
     f. **summary**: ImportSummary component showing results.

   - Progress during import:
     - Process in chunks of 100
     - Update progress state after each chunk
     - Show progress bar or percentage

   - Navigation:
     - Step indicator at top showing current step (1-5)
     - Back button on steps 2-4 to go to previous step
     - Reset/Start Over available from summary

Export both components: `ImportWizard`, `ImportSummary`
  </action>
  <verify>
  - Files exist at src/components/import/import-wizard.tsx and import-summary.tsx
  - TypeScript compiles: `npx tsc --noEmit`
  - Both components export correctly
  </verify>
  <done>ImportWizard manages multi-step flow with progress, ImportSummary shows final results with error details</done>
</task>

<task type="auto">
  <name>Task 2: Create import page route</name>
  <files>src/app/import/page.tsx</files>
  <action>
Create `src/app/import/page.tsx`:

1. Server component (no 'use client')
2. Fetch vendors using getVendors() from queries.ts
3. Layout:
   - Page title: "Bulk Import Products"
   - Subtitle: "Import products from CSV file"
   - Link back to catalog: "Back to Catalog"
   - ImportWizard component with vendors prop

4. Metadata export:
   ```typescript
   export const metadata = {
     title: 'Import Products - MedCatalog',
   };
   ```

5. Styling:
   - Container with max-width and padding
   - Card-like container for wizard
   - Consistent with existing page layouts

Export as default.
  </action>
  <verify>
  - File exists at src/app/import/page.tsx
  - TypeScript compiles: `npx tsc --noEmit`
  - Page loads at http://localhost:3000/import (after dev server start)
  </verify>
  <done>Import page route serves ImportWizard with vendor data</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete CSV import wizard: vendor selection, file upload, column mapping, validation preview, batch import with progress, and results summary</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/import
3. Test full flow:
   a. Select a vendor from dropdown
   b. Upload a CSV file (use sample or create test CSV with columns: name, sku, description, price)
   c. Verify column auto-mapping detects common names
   d. Adjust any unmapped columns
   e. Review validation - check that errors are highlighted
   f. Click Import and watch progress
   g. Verify summary shows correct counts
4. Test edge cases:
   a. Upload CSV with missing required columns - should show mapping errors
   b. Upload CSV with invalid data - should show validation errors
   c. Import same file twice - second import should show "will update" warnings
5. Navigate to catalog and verify imported products appear

Expected: All 6 requirements (IMPORT-01 through IMPORT-06) should be satisfied.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm import works correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. All files exist and compile: `npx tsc --noEmit`
2. `npm run dev` starts without errors
3. /import page loads and shows wizard
4. Full import flow works end-to-end
</verification>

<success_criteria>
- Import page accessible at /import
- Wizard shows clear step progression (vendor -> upload -> mapping -> validation -> importing -> summary)
- Vendor selection required before upload
- File upload triggers CSV parsing
- Column mapping with auto-detection and manual override
- Validation preview shows row-level status and errors
- Import shows progress during batch operation
- Summary shows accurate counts of created/updated/skipped/errors
- Can import same file twice with update detection
- Requirements IMPORT-01 through IMPORT-06 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/06-bulk-import/06-04-SUMMARY.md`
</output>
