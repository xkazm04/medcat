---
phase: 12-ui-polish-and-integration
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/components/chat/quick-actions.tsx
  - src/components/chat/message-list.tsx
  - src/components/chat/product-card.tsx
  - src/components/chat/chat-panel.tsx
  - src/components/catalog-client.tsx
autonomous: false

must_haves:
  truths:
    - "Quick action buttons appear after product search results"
    - "Compare prices button only shows when multiple products displayed"
    - "Clicking quick action sends corresponding message to chat"
    - "Open in catalog button applies vendor/category filters to main table"
    - "Table scrolls into view when Open in catalog is clicked"
    - "Chat remains open after Open in catalog action"
  artifacts:
    - path: "src/components/chat/quick-actions.tsx"
      provides: "Context-aware action buttons component"
      min_lines: 30
    - path: "src/components/catalog-client.tsx"
      contains: "data-table-container"
  key_links:
    - from: "src/components/chat/message-list.tsx"
      to: "QuickActions"
      via: "after tool-searchProducts output"
      pattern: "QuickActions"
    - from: "src/components/chat/product-card.tsx"
      to: "URL params + scrollIntoView"
      via: "onOpenInCatalog callback"
      pattern: "scrollIntoView"
---

<objective>
Add quick action buttons and full catalog integration

Purpose: Users need shortcuts after viewing results (compare, show more, filter), and they need to transfer chat discoveries to the main catalog table. Quick actions appear after product results; "Open in catalog" applies filters and scrolls to table.

Output: QuickActions component integrated after product results, ProductCard wired to URL params + scroll, catalog-client has scroll target.
</objective>

<execution_context>
@C:\Users\mkdol\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\mkdol\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-ui-polish-and-integration/12-CONTEXT.md
@.planning/phases/12-ui-polish-and-integration/12-RESEARCH.md
@.planning/phases/12-ui-polish-and-integration/12-01-SUMMARY.md
@src/components/chat/message-list.tsx
@src/components/chat/product-card.tsx
@src/components/chat/chat-panel.tsx
@src/components/catalog-client.tsx
@src/lib/hooks/use-url-filter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QuickActions and integrate after product results</name>
  <files>
    src/components/chat/quick-actions.tsx
    src/components/chat/message-list.tsx
  </files>
  <action>
1. Create `src/components/chat/quick-actions.tsx`:
   - 'use client' directive
   - Props interface:
     ```typescript
     interface QuickActionsProps {
       productCount: number;
       onCompare: () => void;
       onShowMore: () => void;
       onFilterVendor: () => void;
     }
     ```
   - Context-aware rendering per CONTEXT.md:
     - "Compare prices" button: only if productCount > 1
     - "Show more" button: only if productCount >= 5
     - "Filter by vendor" button: always (if productCount > 0)
   - Style: Ghost buttons with `px-3 py-1.5 text-xs border border-border rounded-md hover:bg-muted transition-colors`
   - Layout: `flex flex-wrap gap-2 mt-3 pt-3 border-t border-border/50`

2. Update `src/components/chat/message-list.tsx`:
   - Import QuickActions from './quick-actions'
   - Add new props to MessageListProps:
     ```typescript
     onCompareResults: () => void;
     onShowMore: () => void;
     onFilterVendor: () => void;
     ```
   - In the `tool-searchProducts` case, after rendering ProductCards (around line 117), add:
     ```tsx
     {toolPart.output.products.length > 0 && (
       <QuickActions
         productCount={toolPart.output.products.length}
         onCompare={onCompareResults}
         onShowMore={onShowMore}
         onFilterVendor={onFilterVendor}
       />
     )}
     ```

3. Update `src/components/chat/chat-panel.tsx`:
   - Add handler functions:
     ```typescript
     const handleCompareResults = () => {
       sendMessage({ text: 'Compare prices for these products' });
     };

     const handleShowMore = () => {
       sendMessage({ text: 'Show more results' });
     };

     const handleFilterVendor = () => {
       sendMessage({ text: 'Filter by vendor' });
     };
     ```
   - Pass new props to MessageList:
     ```tsx
     <MessageList
       ...existing props...
       onCompareResults={handleCompareResults}
       onShowMore={handleShowMore}
       onFilterVendor={handleFilterVendor}
     />
     ```

Per CONTEXT.md: Direct action (clicking sends immediately), ghost button style.
  </action>
  <verify>
    npm run build
    Manual: Search for products, see quick action buttons appear below results, buttons only show when contextually appropriate
  </verify>
  <done>
    Quick action buttons appear after product results with context-aware visibility
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Open in Catalog with URL params and scroll</name>
  <files>
    src/components/chat/product-card.tsx
    src/components/chat/chat-panel.tsx
    src/components/catalog-client.tsx
  </files>
  <action>
1. Update `src/components/catalog-client.tsx`:
   - Add `data-table-container` attribute to the table wrapper div (line 93):
     ```tsx
     <div className="relative" data-table-container>
     ```

2. Update `src/components/chat/product-card.tsx`:
   - Change onViewInCatalog prop type to receive full product:
     `onViewInCatalog: (product: ProductWithRelations) => void;`
   - Update button onClick:
     ```tsx
     onClick={() => onViewInCatalog(product)}
     ```
   - Rename button text from "View in catalog" to "Open in catalog"

3. Update `src/components/chat/chat-panel.tsx`:
   - Import `useRouter` and `useSearchParams` from 'next/navigation'
   - Update handleViewInCatalog to implement URL params + scroll:
     ```typescript
     const router = useRouter();
     const searchParams = useSearchParams();

     const handleViewInCatalog = (product: ProductWithRelations) => {
       const params = new URLSearchParams(searchParams.toString());

       // Apply filters based on product attributes
       if (product.vendor?.id) {
         params.set('vendor', product.vendor.id);
       }
       if (product.emdn_category?.id) {
         params.set('category', product.emdn_category.id);
       }
       params.set('page', '1');

       // Update URL (triggers table re-filter)
       router.push(`?${params.toString()}`);

       // Smooth scroll to table after short delay for URL change
       setTimeout(() => {
         document.querySelector('[data-table-container]')?.scrollIntoView({
           behavior: 'smooth',
           block: 'start',
         });
       }, 100);
     };
     ```
   - Update MessageList prop: `onViewInCatalog={handleViewInCatalog}`

4. Update `src/components/chat/message-list.tsx`:
   - Update onViewInCatalog prop type:
     `onViewInCatalog: (product: ProductWithRelations) => void;`
   - Update ProductCard call:
     ```tsx
     onViewInCatalog={onViewInCatalog}
     ```

Per CONTEXT.md: URL params (shareable), chat stays open, smooth scroll to table.
  </action>
  <verify>
    npm run build
    Manual: Click "Open in catalog" on a product card, URL updates with vendor/category params, table scrolls into view, chat remains open
  </verify>
  <done>
    Open in catalog applies filters via URL params and scrolls table into view while keeping chat open
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 12 UI Polish:
1. Typing indicator showing "Generating response..." before AI response starts
2. Starter prompts (3 chips) on empty chat showcasing features
3. Quick action buttons after product search results (context-aware)
4. "Open in catalog" button that applies filters to main table and scrolls
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000
3. Click the chat button (bottom-right)

**Test typing indicator:**
4. Send any message
5. Verify "Generating response..." appears with animated dots
6. Verify indicator disappears once response text starts streaming

**Test starter prompts:**
7. Clear chat (trash icon)
8. Verify 3 prompt chips appear: "Search for titanium hip implants", "Compare prices for knee prostheses", "Find EU market alternatives"
9. Click one chip
10. Verify message is sent and prompts disappear

**Test quick actions:**
11. Search for products (e.g., "show me knee implants")
12. Verify quick action buttons appear below product cards
13. Verify "Compare prices" only shows if >1 product
14. Click a quick action and verify it sends a message

**Test Open in catalog:**
15. Search for a product with a vendor
16. Click "Open in catalog" on a product card
17. Verify URL updates with vendor/category params
18. Verify main catalog table scrolls into view
19. Verify table shows filtered results matching product
20. Verify chat panel remains open
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
All checks:
- [ ] TypeScript compiles: `npm run build` succeeds
- [ ] QuickActions component exists with context-aware rendering
- [ ] Quick actions appear after product search results
- [ ] "Compare prices" only shows for >1 product
- [ ] "Show more" only shows for >=5 products
- [ ] data-table-container attribute on catalog table wrapper
- [ ] Open in catalog updates URL with vendor/category params
- [ ] Table scrolls into view on Open in catalog
- [ ] Chat stays open after Open in catalog
</verification>

<success_criteria>
1. Quick action buttons appear below product search results
2. "Compare prices" only visible when multiple products shown
3. "Show more" only visible when 5+ products shown
4. Clicking quick action sends corresponding chat message
5. "Open in catalog" applies vendor/category filters to URL
6. Main table scrolls smoothly into view
7. Chat panel remains open for continued conversation
</success_criteria>

<output>
After completion, create `.planning/phases/12-ui-polish-and-integration/12-02-SUMMARY.md`
</output>
