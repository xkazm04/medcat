---
phase: 02-product-management
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/components/product/product-detail.tsx
  - src/components/product/product-form.tsx
  - src/components/product/delete-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Product detail displays all fields in read-only format"
    - "Product form edits all fields with validation"
    - "Delete dialog confirms before deletion"
  artifacts:
    - path: "src/components/product/product-detail.tsx"
      provides: "Read-only product view"
      exports: ["ProductDetail"]
    - path: "src/components/product/product-form.tsx"
      provides: "Edit form with React Hook Form"
      exports: ["ProductForm"]
    - path: "src/components/product/delete-dialog.tsx"
      provides: "Confirmation dialog for deletion"
      exports: ["DeleteDialog"]
  key_links:
    - from: "src/components/product/product-form.tsx"
      to: "src/lib/actions/products.ts"
      via: "updateProduct call"
      pattern: "import.*updateProduct"
    - from: "src/components/product/delete-dialog.tsx"
      to: "src/lib/actions/products.ts"
      via: "deleteProduct call"
      pattern: "import.*deleteProduct"
---

<objective>
Create the three main product feature components: read-only detail view, edit form with React Hook Form + Zod, and delete confirmation dialog.

Purpose: Core product management functionality - view, edit, delete
Output: Three feature components ready for integration into product sheet
</objective>

<execution_context>
@C:\Users\kazda\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kazda\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-product-management/02-RESEARCH.md
@src/lib/types.ts
@src/lib/schemas/product.ts
@src/lib/actions/products.ts
@src/components/product/emdn-breadcrumb.tsx
@src/components/product/regulatory-info.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProductDetail component</name>
  <files>src/components/product/product-detail.tsx</files>
  <action>
Create src/components/product/product-detail.tsx - read-only product information display:

1. Mark 'use client'

2. Import:
   - ProductWithRelations from @/lib/types
   - EMDNBreadcrumb from ./emdn-breadcrumb
   - RegulatoryInfo from ./regulatory-info

3. Props interface (ProductDetailProps):
   - product: ProductWithRelations (with regulatory fields)

4. Layout structure (space-y-6, px-6 py-4, overflow-y-auto):

   Section 1: Basic Info
   - Product name (text-xl font-semibold)
   - SKU below name (text-muted-foreground)
   - Description paragraph (if exists)

   Section 2: Vendor & Pricing (grid 2 cols on md+)
   - Vendor name (or "No vendor")
   - Price formatted in CZK (or "Price not set")

   Section 3: Material
   - Material name (or "Not specified")

   Section 4: EMDN Classification
   - Use EMDNBreadcrumb component
   - Pass path from emdn_category?.path
   - Pass categoryName from emdn_category?.name || 'Unknown'

   Section 5: Regulatory Information
   - Use RegulatoryInfo component
   - Pass udiDi, ceMarked, mdrClass from product
   - Handle potentially undefined fields (use ?? false for ceMarked, ?? null for others)

5. Each section has:
   - Label (text-sm font-medium text-muted-foreground uppercase tracking-wide)
   - Value below (text-base or larger)
   - Divider (border-b border-border, except last section)

6. Export ProductDetail
  </action>
  <verify>
    - npx tsc --noEmit (no type errors)
    - grep "EMDNBreadcrumb" src/components/product/product-detail.tsx
    - grep "RegulatoryInfo" src/components/product/product-detail.tsx
  </verify>
  <done>ProductDetail displays all product fields including EMDN hierarchy and regulatory info</done>
</task>

<task type="auto">
  <name>Task 2: Create ProductForm component</name>
  <files>src/components/product/product-form.tsx</files>
  <action>
Create src/components/product/product-form.tsx - edit form with React Hook Form + Zod:

1. Mark 'use client'

2. Import:
   - useForm from react-hook-form
   - zodResolver from @hookform/resolvers/zod
   - productSchema, ProductFormData from @/lib/schemas/product
   - updateProduct from @/lib/actions/products
   - useTransition from react
   - ProductWithRelations from @/lib/types

3. Props interface (ProductFormProps):
   - product: ProductWithRelations
   - onSuccess?: () => void (callback when save succeeds)
   - vendors: { id: string; name: string }[] (for dropdown)
   - materials: { id: string; name: string }[] (for dropdown)
   - emdnCategories: { id: string; code: string; name: string }[] (for dropdown)

4. Component implementation:
   - const [isPending, startTransition] = useTransition()
   - const [serverError, setServerError] = useState<string | null>(null)

   - Initialize form with useForm<ProductFormData>:
     - resolver: zodResolver(productSchema)
     - defaultValues from product (map all fields)
     - For regulatory fields: use product.udi_di ?? null, product.ce_marked ?? false, product.mdr_class ?? null

5. onSubmit handler:
   - Clear serverError
   - startTransition async:
     - Create FormData from data object
     - Handle boolean ce_marked -> string conversion
     - Call updateProduct(product.id, formData)
     - If success: call onSuccess?.()
     - If error: setServerError(error message)

6. Form fields (space-y-4):
   - Name (text input, required)
   - SKU (text input, required)
   - Description (textarea, optional)
   - Price (number input, optional)
   - Vendor (select dropdown)
   - Material (select dropdown)
   - EMDN Category (select dropdown)
   - UDI-DI (text input, max 14 chars)
   - CE Marked (checkbox)
   - MDR Class (select: I, IIa, IIb, III)

7. Each field structure:
   - Label (text-sm font-medium)
   - Input with {...form.register('fieldName')}
   - Error message if form.formState.errors.fieldName
   - Styling: border border-border rounded-md px-3 py-2, focus:ring-2 focus:ring-accent

8. Server error display (red box at top if serverError)

9. Submit button:
   - Full width, bg-accent text-accent-foreground
   - Disabled when isPending
   - Text: "Saving..." when pending, "Save Changes" otherwise

10. Export ProductForm
  </action>
  <verify>
    - npx tsc --noEmit (no type errors)
    - grep "useForm" src/components/product/product-form.tsx
    - grep "zodResolver" src/components/product/product-form.tsx
    - grep "updateProduct" src/components/product/product-form.tsx
  </verify>
  <done>ProductForm uses React Hook Form with Zod validation and calls updateProduct Server Action</done>
</task>

<task type="auto">
  <name>Task 3: Create DeleteDialog component</name>
  <files>src/components/product/delete-dialog.tsx</files>
  <action>
Create src/components/product/delete-dialog.tsx - confirmation dialog for deletion:

1. Mark 'use client'

2. Import:
   - @radix-ui/react-alert-dialog (AlertDialogPrimitive)
   - motion/react (motion, AnimatePresence)
   - useTransition from react
   - deleteProduct from @/lib/actions/products

3. Props interface (DeleteDialogProps):
   - productId: string
   - productName: string
   - open: boolean
   - onOpenChange: (open: boolean) => void
   - onDeleted?: () => void (callback when deletion succeeds)

4. Component implementation:
   - const [isPending, startTransition] = useTransition()

   handleDelete function:
   - startTransition async:
     - const result = await deleteProduct(productId)
     - If success: onOpenChange(false), onDeleted?.()
     - If error: could show toast or just log

5. Dialog structure using AlertDialogPrimitive:
   - AlertDialogPrimitive.Root (open, onOpenChange props)
   - AlertDialogPrimitive.Portal
   - AnimatePresence for exit animations

   Inside AnimatePresence (when open):
   - Overlay: motion.div with fade animation, fixed inset-0 bg-black/50
   - Content: motion.div with scale animation (0.95 -> 1)
     - Centered: fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2
     - Styling: bg-background border rounded-lg shadow-lg p-6 max-w-md

6. Content structure:
   - Title: "Delete Product" (text-lg font-semibold)
   - Description: "Are you sure you want to delete "{productName}"? This action cannot be undone."
   - Button row (flex justify-end gap-3 mt-6):
     - Cancel button (AlertDialogPrimitive.Cancel): border, hover:bg-muted
     - Delete button (AlertDialogPrimitive.Action): bg-red-600 text-white, onClick={handleDelete}
       - Disabled when isPending
       - Text: "Deleting..." when pending, "Delete" otherwise

7. Export DeleteDialog
  </action>
  <verify>
    - npx tsc --noEmit (no type errors)
    - grep "AlertDialog" src/components/product/delete-dialog.tsx
    - grep "deleteProduct" src/components/product/delete-dialog.tsx
  </verify>
  <done>DeleteDialog confirms deletion and calls deleteProduct Server Action</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. ProductDetail uses child components: `grep -E "EMDNBreadcrumb|RegulatoryInfo" src/components/product/product-detail.tsx`
3. ProductForm uses React Hook Form: `grep "useForm" src/components/product/product-form.tsx`
4. DeleteDialog uses Radix Alert Dialog: `grep "@radix-ui/react-alert-dialog" src/components/product/delete-dialog.tsx`
5. All components import Server Actions: `grep "actions/products" src/components/product/*.tsx`
</verification>

<success_criteria>
- ProductDetail shows all product info including EMDN hierarchy and regulatory fields
- ProductForm validates all fields client-side with Zod
- ProductForm calls updateProduct and handles success/error states
- DeleteDialog shows confirmation with product name
- DeleteDialog calls deleteProduct and closes on success
- All components handle loading/pending states
</success_criteria>

<output>
After completion, create `.planning/phases/02-product-management/02-03-SUMMARY.md`
</output>
